---
title: "CovidDateData"
output: pdf_document
---

```{r}
path = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports/"

yesterdate = format(Sys.Date()-1,"%Y-%m-%d")
dates = format(seq(as.Date("2020-01-22"), as.Date(yesterdate), by="days"), format="%m-%d-%Y")

pathdates = vector("character", length = length(dates))
num = 1
for (i in dates){
  pathdates[num] = paste(path, i, ".csv", sep="")
  num = num+1
}


library(tidyverse)
library(data.table)
allmatrix <- lapply(pathdates, function(i){
  read.csv(i)})


keep = c("Province.State", "Country.Region", "Last.Update","Confirmed","Deaths","Recovered", "Admin2")

lapply(allmatrix, function(x) x[(names(x) %in% keep)])

total = data.frame(matrix(ncol = length(keep), nrow = 0))
for(i in allmatrix)
{
  colnames(i) = gsub("_",".",colnames(i))
  if (!'Admin2' %in% colnames(i))
  {
    i$Admin2 = 0
  }
  i = i[,(names(i) %in% keep)]
  print(length(colnames(i)))
  total = rbind(total, i)
}
total[is.na(total)] <- 0


names(total)[names(total) == 'Last.Update'] <- 'Date'
names(total)[names(total) == 'Admin2'] <- 'County.Other'


multidate <- function(data, formats){
    a<-list()
    for(i in 1:length(formats)){
        a[[i]]<- as.Date(data,format=formats[i])
        a[[1]][!is.na(a[[i]])]<-a[[i]][!is.na(a[[i]])]
        }
    a[[1]]
    }


total$Date <- multidate(total$Date, c("%m/%d/%Y","%m/%d/%y","%Y-%m-%d"))
unique(test)


write_csv(total, "/Users/peteway/Documents/GitHub/COVID19-Analysis/Data/AllDatesData.csv")
```

